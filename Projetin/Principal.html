<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>LoginDisney+ </title>
        <link rel="stylesheet" href="css/principal.css"/>
    </head>
    <body>
        <div class="imagemm">
            <div class="Imagem">
                <img src="IMG/disney-plus-logo-1.png">
            </div>
        </div>
        <input type="text" value="" placeholder="Pesquise por personagem" >
        <input id="bot達o" type="button" value = "Buscar" >
        <button id="bot達oSair">Sair</button>
        <div id="erro" class="erro">Nenhum Resultado Encontrado.</div>
        <div class="Geral">
            <div class="Personagem"></div>
        </div>

        <script type="text/javascript"charset= "utf-8">
        debugger;
        let b = window.localStorage.getItem(window.localStorage.key(0));
        if((window.localStorage.key(0) != null)&&(b != "null")) {
            var Personagem = document.querySelector('.Personagem'),
            input = document.querySelector('input');
            const timeStamp = '1618243974';
            const apiKey = 'cd50d89c84a9a1f4b7f6c6bf6ec03977';
            const md5 = '226b4e02b51dbb95afdcd22f3df94612';
            fetch (`https://gateway.marvel.com:443/v1/public/characters?ts=${timeStamp}&apikey=${apiKey}&hash=${md5}&limit=100`
            ).then((resposta) =>{
                return resposta.json();
            }).then((jsonParsed)=>{
                elementos = jsonParsed.data.count; 
     
                document.getElementById('bot達o').addEventListener('click', function(){
                    Personagem.innerHTML = ''; 
                    document.getElementById("erro").style.display = 'none';
    
                    let contador = 0;
                    if (input.value != ''){
                        for(i=0; i<elementos;i++){
                            const nomeHeroi =  jsonParsed.data.results[i].name
                            if(nomeHeroi.includes(input.value)){
                                contador = 1;
                                const img = document.createElement('img');
                                const li = document.createElement('li');
                                img.src = jsonParsed.data.results[i].thumbnail.path+'.'+jsonParsed.data.results[i].thumbnail.extension
                                li.innerHTML = nomeHeroi;
                                li.appendChild(img); 
                                Personagem.appendChild(li);   
                            }
                        }
                    }
                    if (contador == 0){
                        document.getElementById("erro").style.display = 'block';
                    }
                });
            })
            document.getElementById('bot達oSair').addEventListener('click', function(){
                let id = window.localStorage.key(0);
                window.localStorage.setItem(id, 'null');
                window.location.href = ('//C:/Users/Marco/OneDrive/%C3%81rea%20de%20Trabalho/C%23/Projetin/LoginEmail.html');
            })
        } else {
            alert("Precisa estar logado!!");
            window.location.href = ('//C:/Users/Marco/OneDrive/%C3%81rea%20de%20Trabalho/C%23/Projetin/LoginEmail.html');
        }
        </script>
    </body>
</html>